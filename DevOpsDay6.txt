

Playbook that allows us to deploy tomcat

- name: Install Tomcat
  hosts: all
  become: yes
  vars:
    CATALINA_HOME: /opt/tomcat/apache-tomcat-10.1.19
    JAVA_HOME: "/usr/lib/jvm/java-{{ JAVA_VERSION }}-openjdk-amd64"  # Generalize variables that may change
    JAVA_VERSION: "17"
    PATH: "/opt/tomcat"
    URL: "https://dlcdn.apache.org/tomcat/tomcat-10/v10.1.19/bin/apache-tomcat-{{ VERSION }}.tar.gz"
    VERSION: "10.1.19"
    USER: tomcat
  tasks:
  - name: Install JRE
    package:
      name: "openjdk-{{ JAVA_VERSION }}-jre"
      state: present
      update_cache: yes
  - name: Download Tomcat Tar
    get_url:
      url: "{{ URL }}"
      dest: /tmp
  - name: Create tomcat folder
    file:
      path: "{{ PATH }}"
      state: directory
  - name: Untar Tomcat Tar file
    unarchive:
      src: "/tmp/apache-tomcat-{{ VERSION }}.tar.gz"
      dest: "{{ PATH }}"
  - name: Copy init script
    template:
      src: tomcat-init.j2
      dest: /etc/init.d/tomcat
      mode: "0755"
  - name: Start Tomcat Service
    service:
      name: tomcat
      state: started
  - name: Copy tomcat users
    template:
      src: tomcat-users.xml.j2
      dest: "{{ CATALINA_HOME }}/conf/tomcat-users.xml"
  - name: Copy Manager Context 
    copy:
      src: manager-context.xml
      dest: "{{ CATALINA_HOME }}/webapps/manager/META-INF/context.xml"
  - name: Create user
    user:
      name: "{{ USER }}"
      shell: /bin/bash
      append: yes
      state: present
  - name: Change file ownership, group and permissions
    file: 
      path: "{{ PATH }}"
      owner: "{{ USER }}"
      group: "{{ USER }}"
      mode: "0755"

Concept -> Conditional execution
  handlers in Ansible -> when mostly, but if exists in Ansible
  
  
  sudo apt-get install wget apt-transport-https gnupg lsb-release
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | sudo tee -a /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install trivy